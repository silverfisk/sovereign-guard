<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sovereign Guard – Hardware Watchdog (ESP32-CAM, ESP-IDF/Arduino)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg: #0d1117;
      --surf: #161b22;
      --ink: #f0f6fc;
      --muted: #8b949e;
      --green: #00d084;
      --blue: #2f81f7;
      --red: #ff5c5c;
      --amber: #f59e0b;
      --border: #262c36;
    }
    body{font-family:'Space Grotesk',sans-serif;background:var(--bg);color:var(--ink)}
    .mono{font-family:'JetBrains Mono',monospace}
    .card{background:var(--surf);border:1px solid var(--border);border-radius:12px}
    .pill{border:1px solid var(--border);background:rgba(255,255,255,0.03);border-radius:999px}
    .accent{color:var(--green)}
    .primary{color:var(--blue)}
    .btn{background:linear-gradient(90deg,#2563eb,#1d4ed8);color:white;border-radius:12px;padding:.9rem 1.3rem;font-weight:700}
    a:hover{opacity:.9}
    .grid2{display:grid;gap:1rem;grid-template-columns:1fr 1fr}
    @media(max-width:900px){.grid2{grid-template-columns:1fr}}
    .hline{height:1px;background:var(--border)}
  </style>
</head>
<body>
  <header class="max-w-6xl mx-auto px-6 py-10 text-center">
    <div class="inline-block pill px-4 py-2 mono text-sm mb-6">ESP32-CAM • USB serial • Relay control • Cryptographic auth</div>
    <h1 class="text-5xl md:text-7xl font-bold leading-tight">
      <span class="accent">Sovereign</span> <span class="primary">Guard</span>
    </h1>
    <p class="mono text-lg text-[var(--muted)] mt-4">A hardware watchdog built on <strong>ESP32-CAM</strong> using <strong>ESP-IDF/Arduino</strong>, talking to a Python agent over USB serial.</p>
    <div class="mt-8 flex gap-4 justify-center flex-wrap">
      <a class="btn" href="#overview">Explore</a>
      <a class="btn" style="background:linear-gradient(90deg,#10b981,#059669)" href="#deployment">Deploy</a>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-6 space-y-16 pb-24">

    <!-- Overview -->
    <section id="overview" class="card p-6 md:p-8">
      <h2 class="text-3xl font-bold mb-3">Product Overview</h2>
      <p class="mono text-[15px] text-[var(--muted)]">
        Sovereign Guard is a <b>host-independent watchdog</b>. The Python agent on the server only reports health and executes friendly requests;
        the <b>ESP32 device owns policy & enforcement</b> and can escalate from soft service restarts to OS reboot, then—if required—a hard
        power cycle via relay.
      </p>
      <div class="grid2 mt-6">
        <div class="card p-4">
          <h3 class="font-semibold mb-2">What changed vs earlier drafts</h3>
          <ul class="mono text-[15px] space-y-2 text-[var(--muted)]">
            <li>• Moved device firmware to <b>ESP-IDF/Arduino (C/C++)</b> for robustness.</li>
            <li>• Clarified <b>no USB HID</b> on ESP32-CAM’s USB-UART bridge. (BLE HID optional.)</li>
            <li>• Corrected key storage: classic ESP32 <b>does not have a discrete secure element</b>.
                MVP stores keys in flash; roadmap enables <b>Secure Boot + Flash Encryption</b> or external SE.</li>
            <li>• Formalized <b>device-led escalation ladder</b> and JSON protocol.</li>
          </ul>
        </div>
        <div class="card p-4">
          <h3 class="font-semibold mb-2">Core features</h3>
          <ul class="mono text-[15px] space-y-2 text-[var(--muted)]">
            <li>• USB serial JSON protocol (/dev/ttyUSB*)</li>
            <li>• Relay control for hard power-cycle</li>
            <li>• Device-side policy, backoff, lockout</li>
            <li>• Optional BLE HID (Ctrl+Alt+Del) if host has Bluetooth</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- How it works -->
    <section id="how" class="card p-6 md:p-8">
      <h2 class="text-3xl font-bold mb-3">How it works</h2>
      <div class="grid2 mt-4">
        <div class="card p-4">
          <h3 class="font-semibold mb-2">Escalation ladder</h3>
          <ol class="mono text-[15px] text-[var(--muted)] space-y-2">
            <li><b>Level 1:</b> <i>restart_service</i> (device → agent, systemd restart)</li>
            <li><b>Level 2:</b> <i>reboot_os</i> (device → agent, friendly reboot)</li>
            <li><b>Level 3:</b> <i>relay power-cycle</i> (device toggles relay)</li>
          </ol>
          <p class="mono text-[15px] text-[var(--muted)] mt-2">With stability windows, backoff, and lockout after repeated failures.</p>
        </div>
        <div class="card p-4">
          <h3 class="font-semibold mb-2">Wire protocol (JSON lines)</h3>
<pre class="mono text-[12.5px] bg-black/30 p-3 rounded overflow-auto">
# Agent → Device heartbeat (every 10 s)
{"t":"hb","ts":1699999999,"cpu":0.42,"load1":1.8,"svc_ok":true}

# Device → Agent request
{"t":"request","req_id":"b8e1","action":"restart_service","service":"myapp.service",
 "reason":"svc_unhealthy","deadline_ms":30000}

# Agent → Device replies
{"t":"ack","req_id":"b8e1","status":"executing"}
{"t":"done","req_id":"b8e1","ok":true,"msg":"systemctl restart done"}
</pre>
        </div>
      </div>
    </section>

    <!-- Architecture -->
    <section id="architecture" class="card p-6 md:p-8">
      <h2 class="text-3xl font-bold mb-3">Architecture</h2>
      <div class="grid2 mt-4">
        <div class="card p-4">
          <h3 class="font-semibold mb-2">Device (ESP32-CAM, ESP-IDF/Arduino)</h3>
          <ul class="mono text-[15px] text-[var(--muted)] space-y-2">
            <li>• UART @115200, line-buffered JSON (cJSON / ArduinoJson)</li>
            <li>• Relay driver + timers, watchdog state machine</li>
            <li>• Optional SD logging (audit)</li>
            <li>• <b>Roadmap:</b> Secure Boot + Flash Encryption (IDF)</li>
          </ul>
        </div>
        <div class="card p-4">
          <h3 class="font-semibold mb-2">Server daemon (Python)</h3>
          <ul class="mono text-[15px] text-[var(--muted)] space-y-2">
            <li>• pyserial, psutil, optional FastAPI</li>
            <li>• Whitelist for allowed services to restart</li>
            <li>• Optional GPG/Ed25519 verification for pre-signed bundles</li>
          </ul>
        </div>
      </div>
      <div class="hline my-6"></div>
      <p class="mono text-[15px] text-[var(--muted)]">
        <b>USB HID note:</b> ESP32-CAM’s micro‑USB is a USB‑to‑UART bridge only; it cannot present as a USB keyboard.
        If you need composite USB (CDC + HID), plan a v2 board (ESP32‑S2/S3 or RP2040), or use BLE HID on the ESP32 for Ctrl+Alt+Del.
      </p>
    </section>

    <!-- Deployment -->
    <section id="deployment" class="card p-6 md:p-8">
      <h2 class="text-3xl font-bold mb-3">Deployment (MVP)</h2>
      <ol class="mono text-[15px] text-[var(--muted)] space-y-2">
        <li>1. Flash device firmware (ESP-IDF or Arduino). Configure GPIO for relay, set baud 115200.</li>
        <li>2. Connect to the server via USB; confirm serial device (/dev/ttyUSB*).</li>
        <li>3. Run Python agent (pyserial + psutil). It sends heartbeats and handles device requests.</li>
        <li>4. Test escalation: kill the agent → device should move to friendly reboot → hard relay if needed.</li>
      </ol>
      <div class="mt-6">
        <a class="btn" href="README.md">Open README</a>
      </div>
    </section>

  </main>
</body>
</html>
